<?php
include("auth.html");
?>
<!DOCTYPE html>
<html>
  <head>
    <title>7days</title>
    <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore.js"></script>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
    </script>
  </head>
  <div class="main">
    <div class= "menu">
        <a href="about.html">
            <img src="planner.png" width="100" height="100">
        </a>
        <a href="index.html" class="menufont">This Week</a>
        <a href="weekselector.html" class="menufont">Select Week [Not Implemented Yet]</a>
        <a href="todo.html" class="menufont">To-Do</a>
        <div class="form" style="bottom: 0px; position: absolute;">
            <p>Welcome <?php echo $_SESSION['username']; ?>!</p>
            <a href="dashboard.html">Dashboard</a>
            <a href="logout.html">Logout</a>
        </div>
    </div>
    <div class="body">
      <div class="invest">
        <div class="investbox">
          <h1 style="color: #595959; font: bold 36pt Tahoma,'Segoe UI',Calibri,Thonburi,Arial,Verdana,Sans-Serif,'Mongolian Baiti','Microsoft Yi Baiti','Javanese Text';  background-color:white; margin: 0px; line-height: 80px;" class="Table">To-Do</h1>
          <?php
          $username = $_SESSION['username'];

          $con = mysqli_connect("localhost","root","mysql","$username");
          if (mysqli_connect_errno())
          {
            echo "Failed to connect to MySQL: " . mysqli_connect_error();
          }
          if (!$result = $con->query("DESCRIBE `todo`") ) {
            $con->query("CREATE TABLE `$username`.`todo` (
              content TEXT
            )");
            $con->query("INSERT INTO `$username`.`todo` (content) VALUES ('')");
          }
          $sql_query = "SELECT content FROM `todo`";
          $resultset = mysqli_query($con, $sql_query) or die("database error:". mysqli_error($con));
          while( $developer = mysqli_fetch_assoc($resultset) ) {
          ?>
          <p contenteditable="true" onkeyup="CellChange(this.innerHTML);" onpaste="CellChange(this.innerHTML);">
            <?php echo $developer ['content']; ?>
          </p>
          <?php }
          ?>
        </div>
      </div>
    </div>
  </div>
</html>

<script type="text/javascript">

  function CellChange(a) {
    $.ajax({
      method: "POST",
      url: "live_edit.php",
      data: {
        a: a,  //row
        b: b,  //column title
        c: c,  //data
        d: 'change',
        e: 'todo'
      }
    });
  }

</script>
