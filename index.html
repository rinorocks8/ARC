<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="tablestyles.css">
    <title>ARC</title>
  </head>
  <div class="main">
    <div class="menu">
      <a href="about.html">
        <canvas id="logo" width="160" height="60">
           Your browser does not support the HTML5 canvas tag.</canvas>
      </a>
      <br>
      <a href="invest.html" class="menufont">Investments</a>
      <a href="index.html" class="menufont">Banking</a></li> 
    </div>
    <div class="body">
      <!-- This is for the modal file requester-->
      <div id="id01" class="w3-modal" style="display: none !important;">
        <div class="w3-modal-content w3-animate-top w3-card-4">
          <header class="w3-container modal-color">
            <h2>Upload File</h2>
          </header>
          <div class="w3-container">
            <p>Input Types: .CSC, .TXT</p>
            <p><input type="file" id="fileUpload" onchange="Upload(); document.getElementById('id01').style.display='none';"></p>
          </div>
          <footer class="w3-container modal-color">
            <p></p>
          </footer>
        </div>
      </div>
      <!-- End of modal file requester-->
      <div class="vertical-split">
        <div class="box-1 column-left">
          <div class="title">Income and Savings</div>
        </div>
        <div class="box-1 column-center">
          <div class="title">Net Budget</div>
        </div>
        <div class="box-1 column-right">
          <div class="title">Purchases</div>
          <div class="container">
            <table id="dvpurchases">
              <colgroup>
                <col span="1" style="width: 25%;">
                <col span="1" style="width: 25%;">
                <col span="1" style="width: 25%;">
                <col span="1" style="width: 25%;">
              </colgroup>
              <tbody>
                <tr>
                  <th>Category</th>
                  <th>Money</th>
                  <th>Company</th>
                  <th>Date</th>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="tablesum" id="purchasesum"></div>
        </div>
      </div>
      <div class="vertical-split">
        <div class="box-2 column-left">
          <div class="title">Summary</div>
          <div class="container">
            <table id="dvdeposit">
              <colgroup>
                <col span="1" style="width: 40%;">
                <col span="1" style="width: 20%;">
                <col span="1" style="width: 20%;">
                <col span="1" style="width: 20%;">
              </colgroup>
              <tbody>
                <tr>
                  <th>Category</th>
                  <th>Money</th>
                  <th>Budget</th>
                  <th>Over/Under</th>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="tablesum">
            <table id="dvsummarysum">
              <tbody>
                <tr>
                  <td>Total</th>
                    <td>100</th>
                    <td>50</th>
                    <td>+50</th>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="box-1 column-right">
          <div class="title">Deposits</div>
          <div class="container">
            <table id="dvdeposit">
              <colgroup>
                <col span="1" style="width: 40%;">
                <col span="1" style="width: 20%;">
                <col span="1" style="width: 20%;">
                <col span="1" style="width: 20%;">
              </colgroup>
              <tbody>
                <tr>
                  <th>Category</th>
                  <th>Money</th>
                  <th>Budget</th>
                  <th>Over/Under</th>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="tablesum" id="depositsum"></div>
        </div>
      </div>
    </div>
  </div>
</html>

<script type="text/javascript">
  function getText(){
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET","https://raw.githubusercontent.com/rinorocks8/ARC/master/Checking1.csv", false);
    return rawFile.responseText;
  }

  function Upload() {
    var skipUpload = true;

    var fileUpload = document.getElementById("fileUpload");
    var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/;
    if (skipUpload == true || regex.test(fileUpload.value.toLowerCase())) {
      if (skipUpload == true || typeof (FileReader) != "undefined") {
        var reader = new FileReader();

        reader.onload = function (e) {
          //define tables
          var tpurchases = document.createElement("table");
          var apurchasessum = 0;

          var tdeposit = document.createElement("table");
          var adepositsum = 0;
          //pareses csv into rows and cells
          if(skipUpload == true){
            var rows = getText().split("\n");
          }else{
            var rows = e.target.result.split("\n");
          }
          for (row of rows) {
            var cells = row.split(",");
            if (cells.length > 1) {
              //sort data
              if (cells[4].substring(0,8) == "PURCHASE"){
                //creates row
                var row = tpurchases.insertRow(-1);

                var end = 50;
                if (cells[4].includes("#"))
                {
                var end = cells[4].indexOf("#") - 1;
                }

                row.insertCell(-1).contentEditable = "true";
                //cell.onchange = function(){alert("test")};

                //money
                row.insertCell(-1).innerHTML = -1*Number(cells[1]).toFixed(2);
                apurchasessum += -1*Number(cells[1]);
                //company
                row.insertCell(-1).innerHTML = cells[4].substring(29, end);
                //date
                row.insertCell(-1).innerHTML = cells[0];

                document.getElementById("dvpurchases").append(row);
              }

              //sort data
              if (cells[4].substring(0, 14) == "MOBILE DEPOSIT"){
                var row = tdeposit.insertRow(-1);
                //money
                row.insertCell(-1).innerHTML = "+"+Number(cells[1]).toFixed(2);
                adepositsum += Number(cells[1]);
                //type
                row.insertCell(-1).innerHTML = "Deposit";
                //sender or check#
                row.insertCell(-1).innerHTML = cells[4].substring(29);
                //date
                row.insertCell(-1).innerHTML = cells[0];

                document.getElementById("dvdeposit").append(row);
              }
              if (cells[4].substring(0, 15) == "ONLINE TRANSFER"){
                var row = tdeposit.insertRow(-1);
                //money
                row.insertCell(-1).innerHTML = "+" + Number(cells[1]).toFixed(2);
                adepositsum += Number(cells[1]);
                //type
                row.insertCell(-1).innerHTML = "Online Transfer";
                //sender or check#
                row.insertCell(-1).innerHTML = cells[4].substring(21, cells[4].indexOf('#') - 26);
                //date
                row.insertCell(-1).innerHTML = cells[0];

                document.getElementById("dvdeposit").append(row);
              }
            }
          }

          document.getElementById("purchasesum").innerHTML = "Total: -" + parseFloat(apurchasessum).toFixed(2);
          document.getElementById("depositsum").innerHTML = "Total: +" + parseFloat(adepositsum).toFixed(2);

          summaryUpdate();

        }
        if(skipUpload == true){
          reader.readAsText(new File([new Blob([""], { type: 'text/plain' })], "foo.txt", {type: "text/plain"}));
        }else{
          reader.readAsText(fileUpload.files[0]);
        }
      } else {
        alert("This browser does not support HTML5.");
      }
    } else {
      alert("Please upload a valid CSV file.");
    }
  }

  function summaryUpdate() {

  }

  function setCookie(name,value,days) {
    var expires = "";
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
  }
  
  function getCookie(name) {
      var nameEQ = name + "=";
      var ca = document.cookie.split(';');
      for(var i=0;i < ca.length;i++) {
          var c = ca[i];
          while (c.charAt(0)==' ') c = c.substring(1,c.length);
          if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
      }
      return null;
  }

  window.onload = Upload();
</script>

<script>
  var c = document.getElementById("logo");
  var ctx = c.getContext("2d");
  ctx.strokeStyle = "black";
  ctx.lineWidth = 8;
  ctx.lineCap = "square";
  //A
  ctx.moveTo(-4,80);
  ctx.lineTo(30,0);
  ctx.stroke();
  ctx.moveTo(28,0);
  ctx.lineTo(61,80);
  ctx.stroke();

  //R
  ctx.moveTo(62,0);
  ctx.lineTo(62,80);
  ctx.stroke();
  ctx.moveTo(73,4);
  ctx.lineTo(78,4);
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(81, 22, 18, -.5 * Math.PI, 0.3 * Math.PI);
  ctx.stroke();
  ctx.moveTo(90,38);
  ctx.lineTo(108,80);
  ctx.stroke();

  //C
  ctx.beginPath();
  ctx.arc(135, 30, 26, 0, 2 * Math.PI);
  ctx.stroke();

  ctx.beginPath();
  ctx.strokeStyle = "#f1f1f1";
  ctx.lineWidth = 35;
  ctx.moveTo(150,30);
  ctx.lineTo(160,30);
  ctx.stroke();

  //A fix
  ctx.beginPath();
  ctx.strokeStyle = "#f1f1f1";
  ctx.lineWidth = 8;
  ctx.moveTo(-15,80);
  ctx.lineTo(21,0);
  ctx.stroke();

  ctx.moveTo(37,0);
  ctx.lineTo(46,20);
  ctx.stroke();
</script>
